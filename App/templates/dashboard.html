<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Resume Analysis Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8f9fa; line-height: 1.6; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 0; text-align: center; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .header p { font-size: 1.2rem; opacity: 0.9; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        /* Score Overview */
        .score-overview { background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; }
        .main-score { font-size: 4rem; font-weight: bold; margin-bottom: 15px; }
        .grade-a { color: #27ae60; } .grade-b { color: #f39c12; } .grade-c { color: #e74c3c; } .grade-d { color: #c0392b; }
        .grade-info { font-size: 1.5rem; color: #7f8c8d; margin-bottom: 20px; }
        .position-badge { background: #3498db; color: white; padding: 10px 20px; border-radius: 25px; font-weight: 600; }
        
        /* Quick Stats */
        .quick-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
        .stat-card { background: white; padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .stat-number { font-size: 2rem; font-weight: bold; color: #3498db; display: block; }
        .stat-label { color: #7f8c8d; font-size: 0.9rem; margin-top: 5px; }
        
        /* Charts Grid */
        .charts-section { margin: 40px 0; }
        .section-title { font-size: 2rem; font-weight: bold; color: #2c3e50; margin-bottom: 30px; text-align: center; }
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 30px; margin-bottom: 40px; }
        .chart-card { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .chart-title { font-size: 1.3rem; font-weight: 600; color: #2c3e50; margin-bottom: 20px; text-align: center; }
        .chart-card img { width: 100%; height: auto; border-radius: 10px; }
        
        /* Skills Analysis */
        .skills-section { background: white; border-radius: 20px; padding: 40px; margin: 40px 0; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .skills-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-top: 30px; }
        .skill-category { padding: 25px; border-radius: 15px; }
        .skills-found { background: linear-gradient(135deg, #d5f4e6 0%, #a8e6cf 100%); border-left: 5px solid #27ae60; }
        .skills-missing { background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); border-left: 5px solid #f39c12; }
        .skill-category h4 { margin-bottom: 15px; font-size: 1.2rem; }
        .skill-list { list-style: none; }
        .skill-list li { padding: 8px 0; font-weight: 500; }
        .skill-list li:before { content: "‚úì "; color: #27ae60; font-weight: bold; margin-right: 8px; }
        .skills-missing .skill-list li:before { content: "‚úó "; color: #e74c3c; }
        
        /* Suggestions */
        .suggestions-section { background: white; border-radius: 20px; padding: 40px; margin: 40px 0; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .suggestion-priority { margin-bottom: 30px; }
        .priority-header { padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; font-weight: 600; }
        .critical { background: linear-gradient(135deg, #fee 0%, #fdd 100%); color: #c33; border-left: 5px solid #e74c3c; }
        .important { background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); color: #856404; border-left: 5px solid #f39c12; }
        .nice_to_have { background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%); color: #0c5460; border-left: 5px solid #17a2b8; }
        .suggestion-item { background: #f8f9fa; padding: 20px; margin-bottom: 15px; border-radius: 10px; border-left: 4px solid #dee2e6; }
        .suggestion-category { font-weight: 600; color: #495057; margin-bottom: 8px; }
        .suggestion-action { font-style: italic; color: #6c757d; margin: 8px 0; }
        .impact-badge { display: inline-block; padding: 4px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: 600; }
        .impact-high { background: #fee; color: #c33; }
        .impact-medium { background: #fff3cd; color: #856404; }
        .impact-low { background: #d1ecf1; color: #0c5460; }
        
        /* Actions */
        .actions-section { text-align: center; margin: 50px 0; }
        .btn { display: inline-block; padding: 15px 30px; margin: 0 15px; border-radius: 10px; text-decoration: none; font-weight: 600; font-size: 1.1rem; transition: all 0.3s ease; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .btn-primary { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; }
        .btn-secondary { background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%); color: white; }
        .btn-success { background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: white; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .charts-grid { grid-template-columns: 1fr; }
            .skills-grid { grid-template-columns: 1fr; }
            .quick-stats { grid-template-columns: repeat(2, 1fr); }
        }
        
        /* Loading Animation */
        .loading { display: none; text-align: center; padding: 50px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>üìä Comprehensive Resume Analysis</h1>
            <p>Professional insights for <strong>{{ position }}</strong> position</p>
        </div>
    </div>

    <div class="container">
        <!-- Score Overview -->
        <div class="score-overview">
            <div class="main-score grade-{{ dashboard_data.analysis.position_score.grade|slice:':1'|lower }}">
                {{ dashboard_data.analysis.position_score.weighted_score|floatformat:1 }}%
            </div>
            <div class="grade-info">Grade: {{ dashboard_data.analysis.position_score.grade }}</div>
            <div class="position-badge">{{ position }} ‚Ä¢ {{ resume.filename }}</div>
            
            <div class="quick-stats">
                <div class="stat-card">
                    <span class="stat-number">{{ dashboard_data.analysis.position_score.experience_score|floatformat:1 }}</span>
                    <span class="stat-label">Experience Score</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ dashboard_data.analysis.position_score.skills_score|floatformat:1 }}</span>
                    <span class="stat-label">Skills Match</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ dashboard_data.analysis.position_score.education_score|floatformat:1 }}</span>
                    <span class="stat-label">Education Score</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ dashboard_data.analysis.position_score.projects_score|floatformat:1 }}</span>
                    <span class="stat-label">Projects Score</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ dashboard_data.analysis.skills_analysis.required_found|length }}</span>
                    <span class="stat-label">Required Skills Found</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ dashboard_data.analysis.suggestions.critical|length }}</span>
                    <span class="stat-label">Critical Issues</span>
                </div>
            </div>
        </div>

        <!-- Main Charts -->
        <div class="charts-section">
            <h2 class="section-title">üìà Visual Analytics Dashboard</h2>
            
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-title">üéØ Overall Performance Gauge</div>
                    {% if dashboard_data.charts.score_gauge %}
                        <img src="data:image/png;base64,{{ dashboard_data.charts.score_gauge }}" alt="Score Gauge">
                    {% else %}
                        <div style="text-align: center; padding: 50px; color: #7f8c8d;">
                            <h3>üìä Charts Not Available</h3>
                            <p>Install matplotlib, pandas, seaborn to see visualizations</p>
                            <code>pip install matplotlib pandas seaborn numpy</code>
                        </div>
                    {% endif %}
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">üï∏Ô∏è Skills & Competencies Radar</div>
                    {% if dashboard_data.charts.skills_radar %}
                        <img src="data:image/png;base64,{{ dashboard_data.charts.skills_radar }}" alt="Skills Radar">
                    {% else %}
                        <div style="text-align: center; padding: 30px; color: #bdc3c7; background: #f8f9fa; border-radius: 10px;">
                            <p>üìä Chart will appear here when visualization libraries are installed</p>
                        </div>
                    {% endif %}
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">üìä Score Breakdown Progress</div>
                    {% if dashboard_data.charts.progress_bars %}
                        <img src="data:image/png;base64,{{ dashboard_data.charts.progress_bars }}" alt="Progress Bars">
                    {% else %}
                        <div style="text-align: center; padding: 30px; color: #bdc3c7; background: #f8f9fa; border-radius: 10px;">
                            <p>üìä Chart will appear here when visualization libraries are installed</p>
                        </div>
                    {% endif %}
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">üî• Skills Matching Heatmap</div>
                    {% if dashboard_data.charts.skills_heatmap %}
                        <img src="data:image/png;base64,{{ dashboard_data.charts.skills_heatmap }}" alt="Skills Heatmap">
                    {% else %}
                        <div style="text-align: center; padding: 30px; color: #bdc3c7; background: #f8f9fa; border-radius: 10px;">
                            <p>üìä Chart will appear here when visualization libraries are installed</p>
                        </div>
                    {% endif %}
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">‚ö†Ô∏è Improvement Priorities</div>
                    {% if dashboard_data.charts.improvement_priority %}
                        <img src="data:image/png;base64,{{ dashboard_data.charts.improvement_priority }}" alt="Improvement Priority">
                    {% else %}
                        <div style="text-align: center; padding: 30px; color: #bdc3c7; background: #f8f9fa; border-radius: 10px;">
                            <p>üìä Chart will appear here when visualization libraries are installed</p>
                        </div>
                    {% endif %}
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">üìà Section Comparison Analysis</div>
                    {% if dashboard_data.charts.section_comparison %}
                        <img src="data:image/png;base64,{{ dashboard_data.charts.section_comparison }}" alt="Section Comparison">
                    {% else %}
                        <div style="text-align: center; padding: 30px; color: #bdc3c7; background: #f8f9fa; border-radius: 10px;">
                            <p>üìä Chart will appear here when visualization libraries are installed</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Full Width Charts -->
            <div class="chart-card" style="margin-bottom: 30px;">
                <div class="chart-title">‚òÅÔ∏è Resume Keywords Cloud</div>
                {% if dashboard_data.charts.wordcloud %}
                    <img src="data:image/png;base64,{{ dashboard_data.charts.wordcloud }}" alt="Word Cloud">
                {% else %}
                    <div style="text-align: center; padding: 50px; color: #bdc3c7; background: #f8f9fa; border-radius: 10px;">
                        <p>‚òÅÔ∏è Keywords visualization will appear here when libraries are installed</p>
                    </div>
                {% endif %}
            </div>
            
            <div class="chart-card">
                <div class="chart-title">üéØ Recommendations Matrix</div>
                {% if dashboard_data.charts.recommendation_chart %}
                    <img src="data:image/png;base64,{{ dashboard_data.charts.recommendation_chart }}" alt="Recommendations">
                {% else %}
                    <div style="text-align: center; padding: 50px; color: #bdc3c7; background: #f8f9fa; border-radius: 10px;">
                        <p>üéØ Recommendations matrix will appear here when libraries are installed</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Skills Analysis -->
        <div class="skills-section">
            <h2 class="section-title">üéØ Detailed Skills Analysis</h2>
            
            <div class="skills-grid">
                <div class="skill-category skills-found">
                    <h4>‚úÖ Required Skills Found ({{ dashboard_data.analysis.skills_analysis.required_found|length }})</h4>
                    <ul class="skill-list">
                        {% for skill in dashboard_data.analysis.skills_analysis.required_found %}
                            <li>{{ skill|title }}</li>
                        {% empty %}
                            <li>No required skills found - this needs immediate attention!</li>
                        {% endfor %}
                    </ul>
                </div>
                
                <div class="skill-category skills-missing">
                    <h4>‚ùå Required Skills Missing ({{ dashboard_data.analysis.skills_analysis.required_missing|length }})</h4>
                    <ul class="skill-list">
                        {% for skill in dashboard_data.analysis.skills_analysis.required_missing %}
                            <li>{{ skill|title }}</li>
                        {% empty %}
                            <li>Excellent! All required skills are present.</li>
                        {% endfor %}
                    </ul>
                </div>
                
                <div class="skill-category skills-found">
                    <h4>‚≠ê Preferred Skills Found ({{ dashboard_data.analysis.skills_analysis.preferred_found|length }})</h4>
                    <ul class="skill-list">
                        {% for skill in dashboard_data.analysis.skills_analysis.preferred_found %}
                            <li>{{ skill|title }}</li>
                        {% empty %}
                            <li>No preferred skills found - consider adding some!</li>
                        {% endfor %}
                    </ul>
                </div>
                
                <div class="skill-category skills-missing">
                    <h4>üí° Preferred Skills to Consider ({{ dashboard_data.analysis.skills_analysis.preferred_missing|length }})</h4>
                    <ul class="skill-list">
                        {% for skill in dashboard_data.analysis.skills_analysis.preferred_missing %}
                            <li>{{ skill|title }}</li>
                        {% empty %}
                            <li>Amazing! You have all preferred skills.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

        <!-- Improvement Suggestions -->
        <div class="suggestions-section">
            <h2 class="section-title">üí° Personalized Improvement Roadmap</h2>
            
            {% for priority, suggestions in dashboard_data.analysis.suggestions.items %}
                {% if suggestions %}
                    <div class="suggestion-priority">
                        <div class="priority-header {{ priority }}">
                            {% if priority == 'critical' %}
                                üö® Critical Priority - Address Immediately
                            {% elif priority == 'important' %}
                                ‚ö†Ô∏è Important Priority - Address Soon
                            {% else %}
                                üí° Nice to Have - Consider for Enhancement
                            {% endif %}
                        </div>
                        
                        {% for suggestion in suggestions %}
                            <div class="suggestion-item">
                                <div class="suggestion-category">{{ suggestion.category }}</div>
                                <div><strong>Issue:</strong> {{ suggestion.issue }}</div>
                                <div class="suggestion-action"><strong>Action:</strong> {{ suggestion.action }}</div>
                                <span class="impact-badge impact-{{ suggestion.impact|lower }}">
                                    Impact: {{ suggestion.impact }}
                                </span>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endfor %}
            
            {% if not dashboard_data.analysis.suggestions.critical and not dashboard_data.analysis.suggestions.important and not dashboard_data.analysis.suggestions.nice_to_have %}
                <div style="text-align: center; padding: 50px; color: #27ae60;">
                    <h3>üéâ Congratulations!</h3>
                    <p>Your resume looks excellent with no major issues identified. You're ready to apply!</p>
                </div>
            {% endif %}
        </div>

        <!-- Action Buttons -->
        <div class="actions-section">
            <a href="{% url 'comprehensive_analysis' %}" class="btn btn-primary">
                üîÑ Analyze Another Resume
            </a>
            <a href="{% url 'compare_positions' %}" class="btn btn-secondary">
                üîç Compare Different Positions
            </a>
            <a href="#" onclick="window.print()" class="btn btn-success">
                üìÑ Print/Save Report
            </a>
        </div>
    </div>

    <script>
        // Print optimization
        window.addEventListener('beforeprint', function() {
            document.body.style.background = 'white';
        });
        
        window.addEventListener('afterprint', function() {
            document.body.style.background = '#f8f9fa';
        });
        
        // Smooth scrolling for internal links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>