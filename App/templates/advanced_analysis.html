<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Resume Analysis</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; }
        
        /* Score Cards */
        .score-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .score-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; }
        .score-number { font-size: 2.5rem; font-weight: bold; margin-bottom: 10px; }
        .score-label { color: #7f8c8d; font-size: 0.9rem; }
        .grade-a { color: #27ae60; } .grade-b { color: #f39c12; } .grade-c { color: #e74c3c; } .grade-d { color: #c0392b; }
        
        /* Analysis Sections */
        .analysis-section { background: white; border-radius: 15px; padding: 30px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .section-title { font-size: 1.5rem; font-weight: bold; color: #2c3e50; margin-bottom: 20px; }
        
        /* Skills Analysis */
        .skills-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .skill-category { padding: 15px; border-radius: 10px; background: #f8f9fa; border-left: 4px solid #3498db; }
        .skill-category h4 { margin-bottom: 10px; color: #2c3e50; }
        .skill-list { list-style: none; }
        .skill-list li { padding: 3px 0; color: #34495e; }
        
        /* Recommendations */
        .recommendation-item { padding: 20px; margin-bottom: 15px; border-radius: 10px; border-left: 5px solid; }
        .critical { background: #fee; border-color: #e74c3c; }
        .important { background: #fff3cd; border-color: #f39c12; }
        .enhancement { background: #d1ecf1; border-color: #17a2b8; }
        
        /* Progress Bars */
        .progress-bar { width: 100%; height: 20px; background: #ecf0f1; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; border-radius: 10px; transition: width 0.3s ease; }
        .progress-excellent { background: #27ae60; }
        .progress-good { background: #f39c12; }
        .progress-fair { background: #e67e22; }
        .progress-poor { background: #e74c3c; }
        
        /* Matching Terms */
        .matching-terms { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .term-tag { background: #3498db; color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.9rem; }
        
        .actions { text-align: center; margin-top: 30px; }
        .btn { display: inline-block; padding: 12px 24px; margin: 0 10px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: transform 0.2s; }
        .btn:hover { transform: translateY(-2px); }
        .btn-primary { background: #3498db; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Advanced Resume Analysis</h1>
            <p>AI-Powered Precision Analysis for <strong>{{ position }}</strong></p>
        </div>
        
        <!-- Main Score Grid -->
        <div class="score-grid">
            <div class="score-card">
                <div class="score-number grade-{{ analysis.advanced.final_score.grade|slice:':1'|lower }}">
                    {{ analysis.advanced.final_score.final_score }}%
                </div>
                <div class="score-label">Overall Score</div>
                <div style="margin-top: 10px; font-weight: 600;">{{ analysis.advanced.final_score.grade }}</div>
            </div>
            
            <div class="score-card">
                <div class="score-number" style="color: #3498db;">
                    {{ analysis.advanced.final_score.percentile }}th
                </div>
                <div class="score-label">Percentile</div>
                <div style="margin-top: 10px; font-size: 0.9rem;">Better than {{ analysis.advanced.final_score.percentile }}% of resumes</div>
            </div>
            
            <div class="score-card">
                <div class="score-number" style="color: #27ae60;">
                    {{ analysis.advanced.skill_analysis.total_skills }}
                </div>
                <div class="score-label">Skills Detected</div>
                <div style="margin-top: 10px; font-size: 0.9rem;">Relevant to {{ position|title }}</div>
            </div>
            
            <div class="score-card">
                <div class="score-number" style="color: #f39c12;">
                    {{ analysis.advanced.semantic_analysis.match_grade }}
                </div>
                <div class="score-label">Job Match</div>
                <div style="margin-top: 10px; font-size: 0.9rem;">{{ analysis.advanced.semantic_analysis.similarity_score|floatformat:1 }}% similarity</div>
            </div>
        </div>
        
        <!-- Component Scores -->
        <div class="analysis-section">
            <h2 class="section-title">üìä Detailed Score Breakdown</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div>
                    <h4>Skills Match ({{ analysis.advanced.final_score.component_scores.skills }}%)</h4>
                    <div class="progress-bar">
                        <div class="progress-fill progress-{% if analysis.advanced.final_score.component_scores.skills >= 80 %}excellent{% elif analysis.advanced.final_score.component_scores.skills >= 60 %}good{% elif analysis.advanced.final_score.component_scores.skills >= 40 %}fair{% else %}poor{% endif %}" 
                             style="width: {{ analysis.advanced.final_score.component_scores.skills }}%"></div>
                    </div>
                </div>
                
                <div>
                    <h4>ATS Compatibility ({{ analysis.advanced.final_score.component_scores.ats_compatibility }}%)</h4>
                    <div class="progress-bar">
                        <div class="progress-fill progress-{% if analysis.advanced.final_score.component_scores.ats_compatibility >= 80 %}excellent{% elif analysis.advanced.final_score.component_scores.ats_compatibility >= 60 %}good{% elif analysis.advanced.final_score.component_scores.ats_compatibility >= 40 %}fair{% else %}poor{% endif %}" 
                             style="width: {{ analysis.advanced.final_score.component_scores.ats_compatibility }}%"></div>
                    </div>
                </div>
                
                <div>
                    <h4>Job Relevance ({{ analysis.advanced.final_score.component_scores.job_match }}%)</h4>
                    <div class="progress-bar">
                        <div class="progress-fill progress-{% if analysis.advanced.final_score.component_scores.job_match >= 80 %}excellent{% elif analysis.advanced.final_score.component_scores.job_match >= 60 %}good{% elif analysis.advanced.final_score.component_scores.job_match >= 40 %}fair{% else %}poor{% endif %}" 
                             style="width: {{ analysis.advanced.final_score.component_scores.job_match }}%"></div>
                    </div>
                </div>
                
                <div>
                    <h4>Experience Quality ({{ analysis.advanced.final_score.component_scores.experience_quality }}%)</h4>
                    <div class="progress-bar">
                        <div class="progress-fill progress-{% if analysis.advanced.final_score.component_scores.experience_quality >= 80 %}excellent{% elif analysis.advanced.final_score.component_scores.experience_quality >= 60 %}good{% elif analysis.advanced.final_score.component_scores.experience_quality >= 40 %}fair{% else %}poor{% endif %}" 
                             style="width: {{ analysis.advanced.final_score.component_scores.experience_quality }}%"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Skills Analysis -->
        <div class="analysis-section">
            <h2 class="section-title">üéØ Advanced Skills Analysis</h2>
            <div class="skills-grid">
                {% for category, skills in analysis.advanced.skill_analysis.found_skills.items %}
                    {% if skills %}
                    <div class="skill-category">
                        <h4>{{ category|title|cut:"_" }} ({{ skills|length }})</h4>
                        <ul class="skill-list">
                            {% for skill in skills|slice:":5" %}
                                <li>‚úì {{ skill|title }}</li>
                            {% endfor %}
                            {% if skills|length > 5 %}
                                <li style="color: #7f8c8d;">... and {{ skills|length|add:"-5" }} more</li>
                            {% endif %}
                        </ul>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        
        <!-- Semantic Analysis -->
        <div class="analysis-section">
            <h2 class="section-title">üîç Job Matching Analysis</h2>
            <p><strong>Semantic Similarity:</strong> {{ analysis.advanced.semantic_analysis.similarity_score|floatformat:1 }}% - {{ analysis.advanced.semantic_analysis.match_grade }}</p>
            
            <h4 style="margin-top: 20px;">Top Matching Keywords:</h4>
            <div class="matching-terms">
                {% for term in analysis.advanced.semantic_analysis.matching_terms|slice:":10" %}
                    <span class="term-tag">{{ term }}</span>
                {% endfor %}
            </div>
        </div>
        
        <!-- ATS Analysis -->
        <div class="analysis-section">
            <h2 class="section-title">ü§ñ ATS Compatibility Analysis</h2>
            <p><strong>Overall ATS Score:</strong> {{ analysis.advanced.ats_analysis.total_score }}% - {{ analysis.advanced.ats_analysis.grade }}</p>
            
            <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div>
                    <strong>Action Verbs:</strong> {{ analysis.advanced.ats_analysis.details.action_verbs.count }}<br>
                    <small>Score: {{ analysis.advanced.ats_analysis.details.action_verbs.score }}/20</small>
                </div>
                <div>
                    <strong>Quantified Results:</strong> {{ analysis.advanced.ats_analysis.details.quantified_achievements.count }}<br>
                    <small>Score: {{ analysis.advanced.ats_analysis.details.quantified_achievements.score }}/25</small>
                </div>
                <div>
                    <strong>Sections Found:</strong> {{ analysis.advanced.ats_analysis.details.sections.found }}<br>
                    <small>Score: {{ analysis.advanced.ats_analysis.details.sections.score }}/20</small>
                </div>
                <div>
                    <strong>Word Count:</strong> {{ analysis.advanced.ats_analysis.details.length.word_count }}<br>
                    <small>Score: {{ analysis.advanced.ats_analysis.details.length.score }}/15</small>
                </div>
            </div>
        </div>
        
        <!-- Recommendations -->
        <div class="analysis-section">
            <h2 class="section-title">üí° Precision Recommendations</h2>
            
            {% for priority, recommendations in analysis.advanced.recommendations.items %}
                {% if recommendations %}
                    <h3 style="margin: 20px 0 15px 0;">
                        {% if priority == 'critical' %}üö® Critical Priority
                        {% elif priority == 'important' %}‚ö†Ô∏è Important Priority  
                        {% else %}‚ú® Enhancement Opportunities
                        {% endif %}
                    </h3>
                    
                    {% for rec in recommendations %}
                        <div class="recommendation-item {{ priority }}">
                            <h4>{{ rec.category }}</h4>
                            <p><strong>Issue:</strong> {{ rec.issue }}</p>
                            <p><strong>Action:</strong> {{ rec.action }}</p>
                            <p><strong>Impact:</strong> {{ rec.impact }}</p>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endfor %}
        </div>
        
        <div class="actions">
            <a href="{% url 'enhanced_analysis' %}" class="btn btn-primary">üîÑ Analyze Another Resume</a>
            <a href="{% url 'compare_positions' %}" class="btn btn-primary">üîç Compare Positions</a>
        </div>
    </div>
</body>
</html>